<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Keramik/Granit - Sekawan Jaya</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a1931 0%, #185adb 50%, #3b82f6 100%);
            min-height: 100vh; 
            padding: 10px;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0a1929 0%, #1a3658 100%);
        }
        
        .container {
            max-width: 1000px; 
            margin: 0 auto 20px auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(10, 25, 49, 0.2);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        body.dark-mode .container {
            background: rgba(26, 35, 51, 0.98);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .header {
            background: linear-gradient(135deg, #0a1931 0%, #185adb 50%, #3b82f6 100%);
            color: white; 
            padding: 30px 20px; 
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #0a2542 0%, #154874 100%);
        }
        
        .header h1 { 
            font-size: 1.8rem; 
            margin-bottom: 8px; 
        }
        .header p { 
            font-size: 1rem; 
            opacity: 0.95; 
        }
        
        .calculator { 
            padding: 30px; 
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-row {
            display: flex; 
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block; 
            font-weight: 600; 
            color: #0a1931;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        body.dark-mode label {
            color: #6ab0ff;
        }
        
        input, select {
            width: 100%; 
            padding: 12px; 
            border: 2px solid #e1e8ed;
            border-radius: 10px; 
            font-size: 1rem; 
            background: white;
            color: #333;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none; 
            border-color: #185adb;
            box-shadow: 0 0 0 3px rgba(24, 90, 219, 0.15);
            transform: translateY(-2px);
        }

        body.dark-mode input, 
        body.dark-mode select {
            background: #2a3b52;
            border-color: #3a506b;
            color: #e1e8ed;
        }
        
        /* Input validation styles */
        input:invalid {
            border-color: #dc3545;
        }
        
        input:valid {
            border-color: #28a745;
        }
        
        /* Grid untuk opsi keramik */
        .granite-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px; 
            margin-top: 10px;
        }
        
        .granite-option {
            cursor: pointer; 
            border: 3px solid #e1e8ed; 
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center; 
            background: white;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .granite-option:hover {
            border-color: #185adb; 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(24, 90, 219, 0.25);
        }

        body.dark-mode .granite-option {
            background: #2a3b52;
            border-color: #3a506b;
            color: #e1e8ed;
        }
        
        .granite-option.selected {
            border-color: #185adb;
            background: linear-gradient(135deg, #0a1931 0%, #185adb 50%, #3b82f6 100%);
            color: white;
        }

        body.dark-mode .granite-option.selected {
            background: linear-gradient(135deg, #0a2542 0%, #1c6ea4 100%);
        }
        
        .granite-option input[type="radio"] { display: none; }
        
        .granite-size { 
            font-weight: 600; 
            font-size: 1rem; 
            margin-bottom: 4px; 
            line-height: 1.2;
        }
        
        .granite-area { 
            font-size: 0.85rem; 
            opacity: 0.8; 
            line-height: 1.2;
        }
        
        .calculate-btn {
            width: 100%; 
            background: linear-gradient(135deg, #0a1931 0%, #185adb 50%, #3b82f6 100%);
            color: white; 
            border: none; 
            padding: 16px; 
            font-size: 1.1rem; 
            font-weight: 600;
            border-radius: 12px; 
            cursor: pointer; 
            margin: 25px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(10, 25, 49, 0.3);
            position: relative;
            overflow: hidden;
        }

        .calculate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 25, 49, 0.4);
        }

        .calculate-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        body.dark-mode .calculate-btn {
            background: linear-gradient(135deg, #0a2542 0%, #1c6ea4 100%);
        }
        
        /* Success Checkmark Animation */
        .success-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .success-animation.show {
            opacity: 1;
            visibility: visible;
        }

        .checkmark-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: scaleIn 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .checkmark {
            width: 30px;
            height: 30px;
            stroke: #28a745;
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .checkmark-path {
            stroke-dasharray: 20;
            stroke-dashoffset: 20;
            animation: drawCheck 0.4s 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes drawCheck {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .result {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border-radius: 15px; 
            padding: 25px; 
            margin-top: 25px;
            text-align: center; 
            border: 2px solid rgba(24, 90, 219, 0.15);
            opacity: 0; 
            transform: translateY(20px);
            transition: all 0.3s ease;
            display: none;
        }

        .result.show { 
            opacity: 1; 
            transform: translateY(0); 
            display: block;
        }

        body.dark-mode .result {
            background: linear-gradient(135deg, #1c2e45 0%, #223653 100%);
            border-color: rgba(58, 80, 107, 0.3);
        }
        
        .result h3 { 
            color: #0a1931; 
            font-size: 1.5rem; 
            margin-bottom: 20px; 
        }

        body.dark-mode .result h3 {
            color: #6ab0ff;
        }
        
        .result-details {
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 15px; 
            margin-bottom: 25px;
        }
        
        .result-item {
            background: white; 
            padding: 18px 15px; 
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(10, 25, 49, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        body.dark-mode .result-item {
            background: #2a3b52;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .result-item .label { 
            font-size: 0.9rem; 
            color: #6c757d; 
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        body.dark-mode .result-item .label {
            color: #a0b3c9;
        }
        
        .result-item .value { 
            font-size: 1.4rem; 
            font-weight: 700; 
            color: #0a1931;
            transition: color 0.3s ease;
            margin-top: 5px;
        }

        body.dark-mode .result-item .value {
            color: #6ab0ff;
        }
        
        .whatsapp-btn {
            background: #25D366; 
            color: white; 
            border: none;
            padding: 16px 30px; 
            font-size: 1.1rem; 
            font-weight: 600;
            border-radius: 12px; 
            cursor: pointer; 
            text-decoration: none;
            display: inline-flex; 
            align-items: center; 
            gap: 12px;
            transition: all 0.3s ease;
            margin: 10px 5px;
			box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover { 
            background: #128C7E; 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
        }
        
        .print-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .print-btn:hover {
            background: #495057;
            transform: translateY(-2px);
        }
        
        .whatsapp-icon, .print-icon { 
            width: 20px; 
            height: 20px; 
            fill: currentColor; 
        }
        
        small {
            color: #6c757d;
            font-size: 0.8rem;
            display: block;
            margin-top: 4px;
            transition: color 0.3s ease;
        }

        body.dark-mode small {
            color: #a0b3c9;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #185adb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        body.dark-mode .spinner {
            border: 4px solid #2a3b52;
            border-top: 4px solid #6ab0ff;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            display: none;
            font-size: 0.9rem;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        body.dark-mode .alert-error {
            background-color: #452a2e;
            color: #e88d98;
            border-color: #5c343a;
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-mode-toggle svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        body.dark-mode .dark-mode-toggle {
            background: rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .dark-mode-toggle:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .dark-mode-toggle .moon-icon {
            display: none;
        }

        .dark-mode-toggle .sun-icon {
            display: block;
        }

        body.dark-mode .dark-mode-toggle .moon-icon {
            display: block;
        }

        body.dark-mode .dark-mode-toggle .sun-icon {
            display: none;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Footer Styles - MODIFIED */
        .footer {
            text-align: center;
            padding: 20px;
            margin: 20px auto 10px auto;
            max-width: 1000px;
            color: white;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        body.dark-mode .footer {
            color: #e1e8ed;
        }

        .footer p {
            margin: 0;
            opacity: 0.9;
        }

        /* Responsiveness */
        @media (max-width: 768px) {
            .container {
                margin: 5px auto 15px auto;
                border-radius: 15px;
            }
            .header {
                padding: 25px 15px;
            }
            .calculator {
                padding: 20px 15px;
            }
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .result {
                padding: 20px 15px;
                margin-top: 20px;
            }
            
            .result h3 {
                font-size: 1.3rem;
                margin-bottom: 20px;
            }
            
            .result-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin-bottom: 20px;
            }
            
            .result-item {
                padding: 15px 10px;
                min-height: 75px;
                border-radius: 10px;
            }
            
            .result-item .label {
                font-size: 0.85rem;
                font-weight: 600;
                margin-bottom: 8px;
            }
            
            .result-item .value {
                font-size: 1.2rem;
                font-weight: 700;
                line-height: 1.2;
            }
            
            .whatsapp-btn, .print-btn {
                width: 100%;
                justify-content: center;
                margin: 8px 0;
                padding: 14px 20px;
                font-size: 1rem;
            }
            
            .granite-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .granite-option {
                min-height: 65px;
                padding: 10px 5px;
            }
            .granite-size {
                font-size: 0.95rem;
            }
            .granite-area {
                font-size: 0.8rem;
            }
            
            .footer {
                padding: 15px;
                font-size: 0.85rem;
                margin-top: 15px;
            }
        }

        @media (max-width: 480px) {
            .result-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .result-item {
                padding: 12px 8px;
                min-height: 70px;
            }
            
            .result-item .label {
                font-size: 0.8rem;
            }
            
            .result-item .value {
                font-size: 1.1rem;
            }
            
            .granite-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer {
                padding: 12px;
                font-size: 0.8rem;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Konten HTML tetap sama persis seperti sebelumnya -->
    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <h1>Kalkulator Keramik/Granit<br>Sekawan Jaya</h1>
            <p>Hitung kebutuhan keramik/granit untuk proyek Anda dengan akurat</p>
        </div>

        <div class="calculator">
            <form id="graniteForm">
                <div class="form-group">
                    <label>Nama</label>
                    <input type="text" id="customerName" placeholder="Masukkan nama panggilan Anda" required minlength="2" maxlength="50">
                </div>
                
                <div class="form-group">
                    <label>Nomor WhatsApp 
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">Format: 08xxxxxxxxxx (Tanpa kode negara)</span>
                        </span>
                    </label>
                    <input type="tel" id="phoneNumber" placeholder="08xxxxxxxxxx" pattern="0[0-9]{8,12}" required maxlength="13">
                    <small>Format: 08xxxxxxxxxx</small>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Panjang Ruangan (meter)</label>
                        <input type="number" id="roomLength" placeholder="0" step="0.01" min="0.1" max="100" required>
                    </div>
                    <div class="form-group">
                        <label>Lebar Ruangan (meter)</label>
                        <input type="number" id="roomWidth" placeholder="0" step="0.01" min="0.1" max="100" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pilih Ukuran Keramik/Granit 
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">Pilih ukuran sesuai kebutuhan ruangan Anda</span>
                        </span>
                    </label>
                    <div class="granite-grid">
                        <div class="granite-option" data-size="30x30" data-area="0.99">
                            <input type="radio" name="graniteSize" value="30x30">
                            <div class="granite-size">30×30 cm</div>
                            <div class="granite-area">0.99 m²/dus</div>
                        </div>
                        <div class="granite-option" data-size="40x40" data-area="0.96">
                            <input type="radio" name="graniteSize" value="40x40">
                            <div class="granite-size">40×40 cm</div>
                            <div class="granite-area">0.96 m²/dus</div>
                        </div>
                        <div class="granite-option" data-size="60x60" data-area="1.44">
                            <input type="radio" name="graniteSize" value="60x60">
                            <div class="granite-size">60×60 cm</div>
                            <div class="granite-area">1.44 m²/dus</div>
                        </div>
                        <div class="granite-option" data-size="80x80" data-area="2.56">
                            <input type="radio" name="graniteSize" value="80x80">
                            <div class="granite-size">80×80 cm</div>
                            <div class="granite-area">2.56 m²/dus</div>
                        </div>
                        <div class="granite-option" data-size="100x100" data-area="2.00">
                            <input type="radio" name="graniteSize" value="100x100">
                            <div class="granite-size">100×100 cm</div>
                            <div class="granite-area">2.00 m²/dus</div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="calculate-btn" id="calculateBtn">
                    <span class="btn-text">Hitung Kebutuhan Keramik/Granit</span>
                    <div class="success-animation" id="successAnimation">
                        <div class="checkmark-circle">
                            <svg class="checkmark" viewBox="0 0 24 24">
                                <path class="checkmark-path" d="M9 12l2 2 4-4"/>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Memproses...</p>
                </div>
                
                <div class="alert alert-error" id="errorAlert">
                    ⚠ Terjadi kesalahan. Silakan coba lagi.
                </div>
            </form>

            <div id="result" class="result">
                <h3>📊 Hasil Perhitungan</h3>
                <div class="result-details">
                    <div class="result-item">
                        <div class="label">Luas Area</div>
                        <div class="value" id="totalArea">0 m²</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Ukuran Tile</div>
                        <div class="value" id="selectedSize">-</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Kebutuhan</div>
                        <div class="value" id="totalBoxes">0 dus</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Total + 10%</div>
                        <div class="value" id="totalWithBuffer">0 dus</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <a id="whatsappLink" class="whatsapp-btn" target="_blank">
                        <svg class="whatsapp-icon" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.150-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.520.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.520-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.570-.01-.198 0-.520.074-.792.372-.272.297-1.040 1.016-1.040 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.200 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.360.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.570-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.510-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.640 0 5.122 1.030 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.050 0C5.495 0 .160 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                        </svg>
                        Konsultasi via WhatsApp
                    </a>
                    
                    <button id="printBtn" class="print-btn" onclick="printResult()">
                        <svg class="print-icon" viewBox="0 0 24 24">
                            <path d="M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8M18,19H6V15H18V19M19,13A1,1 0 0,1 18,12A1,1 0 0,1 19,11A1,1 0 0,1 20,12A1,1 0 0,1 19,13M17,9V3H7V9H17Z"/>
                        </svg>
                        Cetak Hasil
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Copyright -->
    <div class="footer">
        <p>© Copyright 2025, Sekawan Jaya, All Rights Reserved.</p>
    </div>

    <script>
        // JavaScript tetap sama persis seperti sebelumnya
        // Pilih ukuran dengan hide previous results
        document.querySelectorAll('.granite-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove selected class from all options
                document.querySelectorAll('.granite-option').forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to current option
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;
                
                // Hide previous calculation results when user changes granite size
                const resultDiv = document.getElementById('result');
                if (resultDiv.classList.contains('show')) {
                    resultDiv.classList.remove('show');
                    
                    // Optional: Add a subtle fade-out animation
                    resultDiv.style.opacity = '0';
                    setTimeout(() => {
                        resultDiv.style.display = 'none';
                        resultDiv.style.opacity = '1'; // Reset for next show
                    }, 300);
                }
            });
        });

        // Dark Mode Functionality
        const darkModeToggle = document.getElementById('darkModeToggle');
        const body = document.body;
        
        // Toggle dark mode
        darkModeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
        });

        // Fungsi yang hilang: resetCalculationState
        function resetCalculationState() {
            // Sembunyikan hasil sebelumnya jika ada
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('show');
            
            // Sembunyikan error alert
            showAlert('error', false);
        }

        // Utility functions
        function showAlert(type, show = true) {
            const errorAlert = document.getElementById('errorAlert');
            
            errorAlert.style.display = 'none';
            
            if (show && type === 'error') {
                errorAlert.style.display = 'block';
                setTimeout(() => errorAlert.style.display = 'none', 5000);
            }
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const btn = document.getElementById('calculateBtn');
            const btnText = btn.querySelector('.btn-text');
            
            loading.style.display = show ? 'block' : 'none';
            btn.disabled = show;
            btnText.textContent = show ? 'Memproses...' : 'Hitung Kebutuhan Keramik/Granit';
        }

        function showSuccess() {
            const successAnimation = document.getElementById('successAnimation');
            const btn = document.getElementById('calculateBtn');
            const btnText = btn.querySelector('.btn-text');
            
            // Add success state to button
            btn.classList.add('success');
            
            // Hide button text and show animation
            btnText.style.opacity = '0';
            successAnimation.classList.add('show');
            
            // After animation completes, restore button
            setTimeout(() => {
                successAnimation.classList.remove('show');
                btnText.style.opacity = '1';
                btn.classList.remove('success');
            }, 2500);
        }

        function validatePhoneNumber(phone) {
            const phoneRegex = /^0[0-9]{8,12}$/;
            return phoneRegex.test(phone);
        }

        // Show calculation results with delay
        function showResults() {
            const resultDiv = document.getElementById('result');
            
            // Reset display state first in case it was hidden
            resultDiv.style.display = 'block';
            resultDiv.style.opacity = '1';
            
            // Then add show class
            resultDiv.classList.add('show');
            
            // Smooth scroll ke hasil setelah animasi muncul
            setTimeout(() => {
                resultDiv.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start' 
                });
            }, 300);
        }

        // Enhanced print function with dark mode support
        function printResult() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('phoneNumber').value;
            const length = document.getElementById('roomLength').value;
            const width = document.getElementById('roomWidth').value;
            const totalArea = document.getElementById('totalArea').textContent;
            const selectedSize = document.getElementById('selectedSize').textContent;
            const totalBoxes = document.getElementById('totalBoxes').textContent;
            const totalWithBuffer = document.getElementById('totalWithBuffer').textContent;
            
            const isDark = document.body.classList.contains('dark-mode');
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Hasil Perhitungan Keramik - Sekawan Jaya</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            padding: 20px; 
                            max-width: 800px; 
                            margin: 0 auto; 
                            ${isDark ? 'background: #2d2d2d; color: #ffffff;' : 'background: white; color: #333;'}
                        }
                        .header { 
                            text-align: center; 
                            border-bottom: 2px solid ${isDark ? '#4a4a4a' : '#0a1931'}; 
                            padding-bottom: 20px; 
                            margin-bottom: 30px; 
                        }
                        .header h1 { 
                            color: ${isDark ? '#185adb' : '#0a1931'}; 
                            margin-bottom: 5px; 
                        }
                        .header p { color: ${isDark ? '#cccccc' : '#666'}; }
                        .customer-info { 
                            background: ${isDark ? '#3a3a3a' : '#f8f9fa'}; 
                            padding: 20px; 
                            border-radius: 8px; 
                            margin-bottom: 30px; 
                        }
                        .customer-info h3 { 
                            color: ${isDark ? '#185adb' : '#0a1931'}; 
                            margin-bottom: 15px; 
                        }
                        .info-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
                        .info-label { font-weight: bold; }
                        .result-details { 
                            display: grid; 
                            grid-template-columns: 1fr 1fr; 
                            gap: 20px; 
                            margin: 20px 0; 
                        }
                        .result-item { 
                            border: 1px solid ${isDark ? '#4a4a4a' : '#ddd'}; 
                            background: ${isDark ? '#3a3a3a' : 'white'};
                            padding: 15px; 
                            text-align: center; 
                            border-radius: 8px;
                        }
                        .result-item .label { 
                            font-size: 14px; 
                            color: ${isDark ? '#999999' : '#666'}; 
                            margin-bottom: 8px; 
                        }
                        .result-item .value { 
                            font-size: 18px; 
                            font-weight: bold; 
                            color: ${isDark ? '#185adb' : '#0a1931'}; 
                        }
                        .footer { 
                            text-align: center; 
                            margin-top: 40px; 
                            padding-top: 20px; 
                            border-top: 1px solid ${isDark ? '#4a4a4a' : '#ddd'}; 
                            color: ${isDark ? '#cccccc' : '#666'}; 
                        }
                        @media print {
                            body { margin: 0; padding: 15px; background: white !important; color: black !important; }
                            .no-print { display: none; }
                            .customer-info { background: #f8f9fa !important; }
                            .result-item { background: white !important; border-color: #ddd !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>SEKAWAN JAYA</h1>
                        <p>Hasil Perhitungan Kebutuhan Keramik/Granit</p>
                        <p><small>Tanggal: ${new Date().toLocaleDateString('id-ID')}</small></p>
                    </div>
                    
                    <div class="customer-info">
                        <h3>Informasi Pelanggan</h3>
                        <div class="info-row">
                            <span class="info-label">Nama:</span>
                            <span>${name}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">No. WhatsApp:</span>
                            <span>${phone}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ukuran Ruangan:</span>
                            <span>${length}m × ${width}m</span>
                        </div>
                    </div>
                    
                    <div class="result">
                        <h3 style="text-align: center; color: ${isDark ? '#185adb' : '#0a1931'};">📊 Hasil Perhitungan</h3>
                        <div class="result-details">
                            <div class="result-item">
                                <div class="label">Luas Area</div>
                                <div class="value">${totalArea}</div>
                            </div>
                            <div class="result-item">
                                <div class="label">Ukuran Keramik/Granit</div>
                                <div class="value">${selectedSize}</div>
                            </div>
                            <div class="result-item">
                                <div class="label">Total Kebutuhan</div>
                                <div class="value">${totalBoxes}</div>
                            </div>
                            <div class="result-item">
                                <div class="label">+ Cadangan 10%</div>
                                <div class="value">${totalWithBuffer}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p><strong>Catatan:</strong></p>
                        <p>• Perhitungan sudah termasuk cadangan 10% untuk antisipasi pemotongan<br>
                        • Hasil ini adalah perkiraan, konsultasi dengan tim kami untuk detail lebih lanjut<br>
                        • Hubungi WhatsApp: 0882-1612-4228</p>
                        <p style="margin-top: 20px;"><em>Terima kasih telah mempercayai Sekawan Jaya</em></p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Form submit dengan enhanced error handling dan fixed timing
        document.getElementById('graniteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log("Form submitted!"); // Debug log
            
            // Reset state before starting new calculation
            resetCalculationState();
            
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('phoneNumber').value.trim();
            const length = parseFloat(document.getElementById('roomLength').value);
            const width = parseFloat(document.getElementById('roomWidth').value);
            const selectedOption = document.querySelector('input[name="graniteSize"]:checked');
            
            console.log("Form data:", {name, phone, length, width, selectedOption}); // Debug log
            
            // Enhanced validation
            if (!name || name.length < 2) {
                alert('⚠ Nama harus minimal 2 karakter!');
                document.getElementById('customerName').focus();
                return;
            }
            
            if (name.length > 50) {
                alert('⚠ Nama terlalu panjang! Maksimal 50 karakter.');
                document.getElementById('customerName').focus();
                return;
            }
            
            if (!validatePhoneNumber(phone)) {
                alert('⚠ Format nomor WhatsApp tidak valid!\nGunakan format: 08xxxxxxxxxx');
                document.getElementById('phoneNumber').focus();
                return;
            }
            
            if (length <= 0 || width <= 0) {
                alert('⚠ Panjang dan lebar ruangan harus lebih dari 0!');
                return;
            }
            
            if (length > 100 || width > 100) {
                alert('⚠ Ukuran ruangan terlalu besar! Maksimal 100 meter.');
                return;
            }
            
            if (!selectedOption) {
                alert('⚠ Silakan pilih ukuran keramik/granit!');
                return;
            }
            
            console.log("Validation passed, calculating..."); // Debug log
            
            const graniteSize = selectedOption.value;
            const selectedDiv = document.querySelector(`.granite-option[data-size="${graniteSize}"]`);
            const areaPerBox = parseFloat(selectedDiv.getAttribute('data-area'));
            
            const totalArea = length * width;
            const totalBoxes = Math.ceil(totalArea / areaPerBox);
            const totalWithBuffer = Math.ceil(totalBoxes * 1.1); // +10% cadangan
            
            console.log("Calculation results:", {totalArea, totalBoxes, totalWithBuffer}); // Debug log
            
            // FIXED TIMING: Update hasil perhitungan ke UI tapi jangan tampilkan dulu
            document.getElementById('totalArea').textContent = totalArea.toFixed(2) + ' m²';
            document.getElementById('selectedSize').textContent = graniteSize + ' cm';
            document.getElementById('totalBoxes').textContent = totalBoxes + ' dus';
            document.getElementById('totalWithBuffer').textContent = totalWithBuffer + ' dus';
            
            // Show loading
            showLoading(true);
            
            // Enhanced data untuk Google Apps Script
            const calculationData = {
                timestamp: new Date().toLocaleString('id-ID', {
                    timeZone: 'Asia/Jakarta',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                name: name,
                phone: phone,
                length: length,
                width: width,
                size: graniteSize,
                areaPerBox: areaPerBox,
                totalArea: totalArea.toFixed(2),
                totalBoxes: totalBoxes,
                totalWithBuffer: totalWithBuffer,
                userAgent: navigator.userAgent,
                referrer: document.referrer || 'Direct'
            };
            
            // Prepare WhatsApp message
            const showroomNumber = "6288216124228";
            const message = `*KONSULTASI KERAMIK/GRANIT*

*Data Pelanggan:*
• Nama: ${name}

*Detail Ruangan:*
• Ukuran: ${length}m × ${width}m
• Luas total: ${totalArea.toFixed(2)} m²

*Kebutuhan Material:*
• Ukuran keramik: ${graniteSize} cm
• Kebutuhan minimal: ${totalBoxes} dus
• Dengan cadangan 10%: *${totalWithBuffer} dus*

Mohon info harga dan ketersediaan stok.
Terima kasih!

_Dihitung via Kalkulator Sekawan Jaya_`;

            const whatsappUrl = `https://wa.me/${showroomNumber}?text=${encodeURIComponent(message)}`;
            document.getElementById('whatsappLink').href = whatsappUrl;
            
            // Kirim data ke Google Apps Script dengan retry mechanism
            let retryCount = 0;
            const maxRetries = 3;
            
            function sendData() {
                fetch("https://script.google.com/macros/s/AKfycbw7n35A6yGf26GJLuDYtyPlfHNMXPW0_1j-gPzaLoOeUCvea6MOq3gZRU9urxbxQaXsfQ/exec", {
                    method: "POST",
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(calculationData)
                })
                .then(response => {
                    console.log("✅ Data berhasil dikirim ke spreadsheet");
                })
                .catch(err => {
                    console.error("⚠ Error mengirim data:", err);
                    retryCount++;
                    if (retryCount < maxRetries) {
                        console.log(`🔄 Mencoba lagi... (${retryCount}/${maxRetries})`);
                        setTimeout(sendData, 2000 * retryCount); // Increasing delay
                    } else {
                        console.log("⚠ Gagal setelah 3 kali percobaan");
                        showAlert('error');
                    }
                });
            }
            
            sendData();

            // FIXED SEQUENCE: Show success animation first, then results
            setTimeout(() => {
                console.log("Starting success animation..."); // Debug log
                showLoading(false);
                showSuccess(); // Show checkmark animation first
                
                // After success animation starts, show results
                setTimeout(() => {
                    console.log("Showing results..."); // Debug log
                    showResults(); // Show calculation results with smooth scroll
                }, 1000); // Delay hasil sampai animasi centang terlihat dulu
                
            }, 1500); // Simulasi processing time
        });

        // Real-time validation indicators
        document.querySelectorAll('input[required]').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.checkValidity()) {
                    this.style.borderColor = '#28a745';
                } else {
                    this.style.borderColor = '#dc3545';
                }
            });
            
            input.addEventListener('input', function() {
                if (this.checkValidity()) {
                    this.style.borderColor = '#28a745';
                } else if (this.value.length > 0) {
                    this.style.borderColor = '#dc3545';
                } else {
                    this.style.borderColor = '#e1e8ed';
                }
            });
        });

        // Enhanced phone number formatting
        document.getElementById('phoneNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 13) value = value.substr(0, 13);
            e.target.value = value;
        });

        document.getElementById('phoneNumber').addermostListener('keypress', function(e) {
            // Only allow numbers
            if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(e.key)) {
                e.preventDefault();
            }
        });

        // Auto-focus next field on Enter
        document.querySelectorAll('input').forEach((input, index, inputs) => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && index < inputs.length - 1) {
                    e.preventDefault();
                    inputs[index + 1].focus();
                }
            });
        });

        // Handle offline/online status
        window.addEventListener('online', () => {
            console.log('🌐 Kembali online');
        });

        window.addEventListener('offline', () => {
            console.log('📱 Mode offline');
            showAlert('error');
            document.getElementById('errorAlert').innerHTML = '⚠️ Tidak ada koneksi internet. Data akan disimpan ketika online kembali.';
        });
    </script>
</body>

</html>
